"use strict";var __awaiter=this&&this.__awaiter||function(i,n,e,o){return new(e||(e=Promise))((function(t,r){function a(i){try{s(o.next(i))}catch(i){r(i)}}function l(i){try{s(o.throw(i))}catch(i){r(i)}}function s(i){var n;i.done?t(i.value):(n=i.value,n instanceof e?n:new e((function(i){i(n)}))).then(a,l)}s((o=o.apply(i,n||[])).next())}))},__generator=this&&this.__generator||function(i,n){var e,o,t,r,a={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(l){return function(s){return function(l){if(e)throw new TypeError("Generator is already executing.");for(;r&&(r=0,l[0]&&(a=0)),a;)try{if(e=1,o&&(t=2&l[0]?o.return:l[0]?o.throw||((t=o.return)&&t.call(o),0):o.next)&&!(t=t.call(o,l[1])).done)return t;switch(o=0,t&&(l=[2&l[0],t.value]),l[0]){case 0:case 1:t=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,o=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(t=a.trys,(t=t.length>0&&t[t.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!t||l[1]>t[0]&&l[1]<t[3])){a.label=l[1];break}if(6===l[0]&&a.label<t[1]){a.label=t[1],t=l;break}if(t&&a.label<t[2]){a.label=t[2],a.ops.push(l);break}t[2]&&a.ops.pop(),a.trys.pop();continue}l=n.call(i,a)}catch(i){l=[6,i],o=0}finally{e=t=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.LinkJumpWay=exports.LinkType=exports.isIOS=exports.isAndroid=void 0,exports.formatLink=formatLink,exports.navigateToLink=navigateToLink;var LinkType,LinkJumpWay,ua_info_1=require("@just4/ua-info"),querystring_1=require("@just4/querystring"),uaInfo=(0,ua_info_1.getCurrentUAInfo)();function invokeNativePointMall(i){var n,e,o,t,r,a;exports.isAndroid?null===(e=null===(n=window.AndroidNative)||void 0===n?void 0:n.toPointMall)||void 0===e||e.call(n,i):exports.isIOS&&(null===(a=null===(r=null===(t=null===(o=window.webkit)||void 0===o?void 0:o.messageHandlers)||void 0===t?void 0:t.gotoPointsMall)||void 0===r?void 0:r.postMessage)||void 0===a||a.call(r,i))}function toNativeLink(i){var n,e,o,t,r=i.androidLink,a=i.iosLink,l=i.otherLink;if((null===(n=window.AndroidNative)||void 0===n?void 0:n.toPointMall)||(null===(t=null===(o=null===(e=window.webkit)||void 0===e?void 0:e.messageHandlers)||void 0===o?void 0:o.gotoPointsMall)||void 0===t?void 0:t.postMessage)){var s=exports.isAndroid?r:a,u=encodeURIComponent(location.href);s=(0,querystring_1.concat)(s,{plt_back_uri:u}),invokeNativePointMall(JSON.stringify({url:s}))}else window.open(l,"_blank","noopener=yes")}function toPlvWebviewBridge(i){return __awaiter(this,void 0,void 0,(function(){var n,e,o,t;return __generator(this,(function(r){switch(r.label){case 0:return n=i.getPlvWebviewSmallWindowSize,e=i.getPlvWebviewBridge,o=(null==n?void 0:n())||{width:90,height:160},[4,null==e?void 0:e()];case 1:return(t=r.sent())?(t.sendData("clickProduct",{width:o.width,height:o.height,newPage:!0,link:i.link,data:i.data}),[2]):[2]}}))}))}function toMultiPlatformLink(i){return __awaiter(this,void 0,void 0,(function(){var n,e,o,t,r,a,l,s,u,d,v;return __generator(this,(function(k){switch(k.label){case 0:n=i.linkData,e=i.isWxMiniProgramEnv,o=i.toWxMiniProgram,t=i.openLink,r=i.getLinkParams,a=i.isMobile,l=n.wxMiniprogramLink,s=n.mobileLink,u=n.pcLink,d=(null==a?void 0:a())||!1,v=!1,k.label=1;case 1:return k.trys.push([1,3,,4]),[4,null==e?void 0:e()];case 2:return v=k.sent()||!1,[3,4];case 3:return k.sent(),v=!1,[3,4];case 4:return v&&l&&o?(o(formatLink(l,r)),[2]):d&&s?(t(formatLink(s,r),LinkJumpWay.NewWindow),[2]):(!d&&u&&t(formatLink(u,r),LinkJumpWay.NewWindow),[2])}}))}))}function formatLink(i,n){var e={};if(n){var o=n(i);e=Object.assign({},e,o)}return(0,querystring_1.concat)(i,e)}function navigateToLink(i){var n=i.linkData,e=i.openLink,o=i.isPlvWebview,t=i.getPlvWebviewSmallWindowSize,r=i.getPlvWebviewBridge,a=i.isWxMiniProgramEnv,l=i.toWxMiniProgram,s=i.getLinkParams,u=i.isMobile,d=n.linkType,v=(null==o?void 0:o())||!1;if(d!==LinkType.Native){if(v){var k="",c=n.link,p=n.mobileLink,f=n.mobileAppLink,L=n.wxMiniprogramOriginalId,m=n.wxMiniprogramLink;switch(d){case LinkType.Normal:k=c;break;case LinkType.MultiPlatform:k=f||p}var w=null;return d!==LinkType.Normal&&(w={mobileLink:formatLink(p,s),wxMiniprogramOriginalId:L,wxMiniprogramLink:formatLink(m,s),mobileAppLink:formatLink(f,s)}),void toPlvWebviewBridge({link:formatLink(k,s),data:w,getPlvWebviewSmallWindowSize:t,getPlvWebviewBridge:r})}if(d!==LinkType.Normal)d===LinkType.MultiPlatform&&toMultiPlatformLink({linkData:n,getLinkParams:s,isWxMiniProgramEnv:a,toWxMiniProgram:l,openLink:e,isMobile:u});else{c=n.link;var g=n.jumpWay;e(formatLink(c,s),g)}}else toNativeLink({androidLink:formatLink(n.androidLink,s),iosLink:formatLink(n.iosLink,s),otherLink:formatLink(n.otherLink,s)})}exports.isAndroid=uaInfo.os.isAndroid,exports.isIOS=uaInfo.os.isIOS,function(i){i[i.Normal=10]="Normal",i[i.MultiPlatform=11]="MultiPlatform",i[i.Native=12]="Native"}(LinkType||(exports.LinkType=LinkType={})),function(i){i.PopUp="POP_UP",i.NewWindow="NEW_WINDOW",i.CurrentWindow="CURRENT_WINDOW"}(LinkJumpWay||(exports.LinkJumpWay=LinkJumpWay={}));