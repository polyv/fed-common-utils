"use strict";var __awaiter=this&&this.__awaiter||function(i,n,e,t){return new(e||(e=Promise))((function(r,o){function a(i){try{l(t.next(i))}catch(i){o(i)}}function s(i){try{l(t.throw(i))}catch(i){o(i)}}function l(i){var n;i.done?r(i.value):(n=i.value,n instanceof e?n:new e((function(i){i(n)}))).then(a,s)}l((t=t.apply(i,n||[])).next())}))},__generator=this&&this.__generator||function(i,n){var e,t,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(e=1,t&&(r=2&s[0]?t.return:s[0]?t.throw||((r=t.return)&&r.call(t),0):t.next)&&!(r=r.call(t,s[1])).done)return r;switch(t=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,t=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=n.call(i,a)}catch(i){s=[6,i],t=0}finally{e=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.LinkJumpWay=exports.LinkType=exports.isMobile=exports.isPcMiniProgram=exports.isWorkWeixin=exports.isWeixin=exports.isIOS=exports.isAndroid=void 0,exports.formatLink=formatLink,exports.navigateToLink=navigateToLink;var LinkType,LinkJumpWay,ua_info_1=require("@just4/ua-info"),querystring_1=require("@just4/querystring"),ua=navigator.userAgent.toLowerCase(),uaInfo=(0,ua_info_1.getCurrentUAInfo)();function getNativeToPointMallFn(){var i,n,e,t;return exports.isAndroid?null===(i=window.AndroidNative)||void 0===i?void 0:i.toPointMall:exports.isIOS?null===(t=null===(e=null===(n=window.webkit)||void 0===n?void 0:n.messageHandlers)||void 0===e?void 0:e.gotoPointsMall)||void 0===t?void 0:t.postMessage:void 0}function toNativeLink(i){var n=i.androidLink,e=i.iosLink,t=i.otherLink,r=getNativeToPointMallFn();if(r){var o=exports.isAndroid?n:e,a=encodeURIComponent(location.href);return o=(0,querystring_1.concat)(o,{plt_back_uri:a}),void r(JSON.stringify({url:o}))}window.open(t,"_blank","noopener=yes")}function toPlvWebviewBridge(i){return __awaiter(this,void 0,void 0,(function(){var n,e,t,r;return __generator(this,(function(o){switch(o.label){case 0:return n=i.getPlvWebviewSmallWindowSize,e=i.getPlvWebviewBridge,t=(null==n?void 0:n())||{width:90,height:160},[4,null==e?void 0:e()];case 1:return(r=o.sent())?(r.sendData("clickProduct",{width:t.width,height:t.height,newPage:!0,link:i.link,data:i.data}),[2]):[2]}}))}))}function toMultiPlatformLink(i){return __awaiter(this,void 0,void 0,(function(){var n,e,t,r,o,a,s,l,u;return __generator(this,(function(p){switch(p.label){case 0:n=i.linkData,e=i.isWxMiniProgramEnv,t=i.toWxMiniProgram,r=i.openLink,o=i.getLinkParams,a=n.wxMiniprogramLink,s=n.mobileLink,l=n.pcLink,u=!1,p.label=1;case 1:return p.trys.push([1,3,,4]),[4,null==e?void 0:e()];case 2:return u=p.sent()||!1,[3,4];case 3:return p.sent(),u=!1,[3,4];case 4:return u&&a&&t?(t(formatLink(a,o)),[2]):exports.isMobile?(r(formatLink(s,o),LinkJumpWay.NewWindow),[2]):(exports.isMobile||r(formatLink(l,o),LinkJumpWay.NewWindow),[2])}}))}))}function formatLink(i,n){var e={};if(n){var t=n(i);e=Object.assign({},e,t)}return(0,querystring_1.concat)(i,e)}function navigateToLink(i){var n=i.linkData,e=i.openLink,t=i.isPlvWebview,r=i.getPlvWebviewSmallWindowSize,o=i.getPlvWebviewBridge,a=i.isWxMiniProgramEnv,s=i.toWxMiniProgram,l=i.getLinkParams,u=n.linkType,p=(null==t?void 0:t())||!1;if(u!==LinkType.Native){if(p){var k="",c=n.link,f=n.mobileLink,v=n.mobileAppLink,d=n.wxMiniprogramOriginalId,m=n.wxMiniprogramLink;switch(u){case LinkType.Normal:k=c;break;case LinkType.MultiPlatform:k=v||f}var L=null;return u!==LinkType.Normal&&(L={mobileLink:formatLink(f,l),wxMiniprogramOriginalId:d,wxMiniprogramLink:formatLink(m,l),mobileAppLink:formatLink(v,l)}),void toPlvWebviewBridge({link:formatLink(k,l),data:L,getPlvWebviewSmallWindowSize:r,getPlvWebviewBridge:o})}if(u!==LinkType.Normal)u===LinkType.MultiPlatform&&toMultiPlatformLink({linkData:n,getLinkParams:l,isWxMiniProgramEnv:a,toWxMiniProgram:s,openLink:e});else{c=n.link;var g=n.jumpWay;e(formatLink(c,l),g)}}else toNativeLink({androidLink:formatLink(n.androidLink,l),iosLink:formatLink(n.iosLink,l),otherLink:formatLink(n.otherLink,l)})}exports.isAndroid=uaInfo.os.isAndroid,exports.isIOS=uaInfo.os.isIOS,exports.isWeixin=uaInfo.client.isWx,exports.isWorkWeixin=uaInfo.client.isWxWork,exports.isPcMiniProgram=(exports.isWeixin||exports.isWorkWeixin)&&/miniprogramenv/.test(ua),exports.isMobile=uaInfo.isPortable||exports.isPcMiniProgram,function(i){i[i.Normal=10]="Normal",i[i.MultiPlatform=11]="MultiPlatform",i[i.Native=12]="Native"}(LinkType||(exports.LinkType=LinkType={})),function(i){i.PopUp="POP_UP",i.NewWindow="NEW_WINDOW",i.CurrentWindow="CURRENT_WINDOW"}(LinkJumpWay||(exports.LinkJumpWay=LinkJumpWay={}));