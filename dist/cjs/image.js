"use strict";function getExtname(e){var t=(e||"").split("."),A=t[t.length-1];return A?A.toLowerCase():""}function handleCompressOptions(e){var t,A,r="number"==typeof e?{width:e}:e;return r.allowJPG=null===(t=r.allowJPG)||void 0===t||t,r.allowWebP=null!==(A=r.allowWebP)&&void 0!==A?A:"auto",r}function createURLObject(e){var t;if("undefined"!=typeof document){var A=document.createElement("a");A.href=e,t=A}else if("function"==typeof URL)try{t=new URL(/^\/\//.test(e)?"https:"+e:e)}catch(e){}return t}function genOSSCompressParams(e,t){var A="";return null==t.width&&null==t.height||(A+="/resize",t.width&&(A+=",w_"+t.width),t.height&&(A+=",h_"+t.height),A+=",limit_1"),t.allowAVIF&&"gif"!==e?A+="/format,avif":!0===t.allowWebP||"auto"===t.allowWebP&&(0,exports.supportWebP)()?A+="/format,webp/quality,Q_80":t.allowJPG&&"gif"!==e&&(A+="/format,jpg/quality,Q_80"),A}function setOSSCompressParams(e,t){var A=!1;return e=e.replace(/([?&]x-oss-process)(?:=([^&]*))?/,(function(e,r,o){return A=!0,/^image/.test(o)?r+"="+o.replace(/\/(?:resize|format|quality)[^/]*/gi,"")+t:e})),A?e:e+(-1===e.indexOf("?")?"?":"&")+"x-oss-process=image"+t}function ossCompress(e,t){var A=createURLObject(e);if(!A)return e;var r=getExtname(A.pathname.split("/").pop());if(!/\.videocc\.net$/i.test(A.hostname)||"svg"===r)return e;var o=genOSSCompressParams(r,handleCompressOptions(t));return o&&(A.search=setOSSCompressParams(A.search,o)),A.href}function genCOSCompressParams(e,t){var A="";return null!=t.width&&null!=t.height?A+="/thumbnail/".concat(t.width,"x").concat(t.height):null!=t.width?A+="/thumbnail/".concat(t.width,"x"):null!=t.height&&(A+="/thumbnail/x".concat(t.height)),t.allowAVIF&&"gif"!==e?A+="/format/avif":!0===t.allowWebP||"auto"===t.allowWebP&&(0,exports.supportWebP)()?A+="/format/webp/quality/80":t.allowJPG&&"gif"!==e&&(A+="/format/jpg/quality/80"),A}function setCOSCompressParams(e,t){var A=!1;return e=e.replace(/([?&]imageMogr2)(\/[^&]*)/,(function(e,r,o){return A=!0,r+"="+o.replace(/\/(?:thumbnail|format|quality)\/[^/]+/gi,"")+t})),A?e:e+(-1===e.indexOf("?")?"?":"&")+"imageMogr2"+t}function cosCompress(e,t){var A=createURLObject(e);if(!A)return e;var r=getExtname(A.pathname.split("/").pop());if(!/(?:\.videocc\.net|\.kingswayvideo\.com)$/i.test(A.hostname)||"svg"===r)return e;var o=genCOSCompressParams(r,handleCompressOptions(t));return o&&(A.search=setCOSCompressParams(A.search,o)),A.href}function compressHTMLImgs(e,t,A){return void 0===A&&(A=ossCompress),e?e.replace(/(<img.*?\ssrc=)(["']?)(.+?)\2(.*?>)/gi,(function(e,r,o,a,n){return r+'"'+A(a,t)+'" data-src="'+a+'"'+n})):""}function preloadImg(e){return new Promise((function(t,A){var r=new Image;function o(){t({width:r.width,height:r.height,element:r})}r.onload=o,r.onerror=function(){A(new Error('"'.concat(e,'" load failed.')))},r.src=e,r.complete&&o()}))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.supportAVIF=exports.supportWebP=void 0,exports.ossCompress=ossCompress,exports.cosCompress=cosCompress,exports.compressHTMLImgs=compressHTMLImgs,exports.preloadImg=preloadImg,exports.supportWebP=function(){var e;return function(){if(null==e)try{e=function(){var e=document.createElement("canvas");if(e.getContext&&e.getContext("2d")){var t="image/webp";return 0===e.toDataURL(t).indexOf("data:"+t)}return!1}()||function(){var e=!1,t=navigator.userAgent,A=/\bOS\s([\d_.]+)\slike\sMac\sOS\sX\b/.exec(t);if(A)e=parseInt(A[1])>=14;else{var r=/\bVersion\/([\d.]+)\sSafari\b/.exec(t);r&&(e=parseInt(r[1])>=16)}return e}()}catch(t){e=!1}return e}}(),exports.supportAVIF=function(){var e;return function(){return e||(e=new Promise((function(e){var t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",t.onerror=function(){e(!1)},t.onload=function(){e(!0)},setTimeout((function(){e(!1)}),1e3)}))),e}}();