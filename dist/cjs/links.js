"use strict";var __awaiter=this&&this.__awaiter||function(i,n,e,t){return new(e||(e=Promise))((function(o,r){function a(i){try{l(t.next(i))}catch(i){r(i)}}function s(i){try{l(t.throw(i))}catch(i){r(i)}}function l(i){var n;i.done?o(i.value):(n=i.value,n instanceof e?n:new e((function(i){i(n)}))).then(a,s)}l((t=t.apply(i,n||[])).next())}))},__generator=this&&this.__generator||function(i,n){var e,t,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(l){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(a=0)),a;)try{if(e=1,t&&(o=2&s[0]?t.return:s[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,s[1])).done)return o;switch(t=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,t=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=n.call(i,a)}catch(i){s=[6,i],t=0}finally{e=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.LinkJumpWay=exports.LinkType=exports.isMobile=exports.isPcMiniProgram=exports.isWorkWeixin=exports.isWeixin=exports.isIOS=exports.isAndroid=void 0,exports.formatLink=formatLink,exports.navigateToLink=navigateToLink;var LinkType,LinkJumpWay,ua_info_1=require("@just4/ua-info"),querystring_1=require("@just4/querystring"),ua=navigator.userAgent.toLowerCase(),uaInfo=(0,ua_info_1.getCurrentUAInfo)();function __isMobile(){var i=navigator.userAgent;return!!/mobile|android/i.test(i)||!/\b(Windows\sNT|Macintosh|x86(_(32|64))?|amd64|i[1-6]86)\b/.test(i)&&"onorientationchange"in window}function getNativeToPointMallFn(){var i,n,e,t;return exports.isAndroid?null===(i=window.AndroidNative)||void 0===i?void 0:i.toPointMall:exports.isIOS?null===(t=null===(e=null===(n=window.webkit)||void 0===n?void 0:n.messageHandlers)||void 0===e?void 0:e.gotoPointsMall)||void 0===t?void 0:t.postMessage:void 0}function toNativeLink(i){var n=i.androidLink,e=i.iosLink,t=i.otherLink,o=getNativeToPointMallFn();if(o){var r=exports.isAndroid?n:e,a=encodeURIComponent(location.href);return r=(0,querystring_1.concat)(r,{plt_back_uri:a}),void o(JSON.stringify({url:r}))}window.open(t,"_blank","noopener=yes")}function toPlvWebviewBridge(i){return __awaiter(this,void 0,void 0,(function(){var n,e,t,o;return __generator(this,(function(r){switch(r.label){case 0:return n=i.getPlvWebviewSmallWindowSize,e=i.getPlvWebviewBridge,t=(null==n?void 0:n())||{width:90,height:160},[4,null==e?void 0:e()];case 1:return(o=r.sent())?(o.sendData("clickProduct",{width:t.width,height:t.height,newPage:!0,link:i.link,data:i.data}),[2]):[2]}}))}))}function toMultiPlatformLink(i){return __awaiter(this,void 0,void 0,(function(){var n,e,t,o,r,a,s,l;return __generator(this,(function(u){switch(u.label){case 0:n=i.linkData,e=i.isWxMiniProgramEnv,t=i.toWxMiniProgram,o=i.openLink,r=n.wxMiniprogramLink,a=n.mobileLink,s=n.pcLink,l=!1,u.label=1;case 1:return u.trys.push([1,3,,4]),[4,null==e?void 0:e()];case 2:return l=u.sent()||!1,[3,4];case 3:return u.sent(),l=!1,[3,4];case 4:return l&&r&&t?(t(formatLink(r)),[2]):exports.isMobile?(o(formatLink(a),LinkJumpWay.NewWindow),[2]):(exports.isMobile||o(formatLink(s),LinkJumpWay.NewWindow),[2])}}))}))}function formatLink(i,n){var e={};if(n){var t=n(i);e=Object.assign({},e,t)}return(0,querystring_1.concat)(i,e)}function navigateToLink(i){var n=i.linkData,e=i.openLink,t=i.isPlvWebview,o=i.getPlvWebviewSmallWindowSize,r=i.getPlvWebviewBridge,a=i.isWxMiniProgramEnv,s=i.toWxMiniProgram,l=n.linkType,u=(null==t?void 0:t())||!1;if(l!==LinkType.Native){if(u){var p="",k=n.link,c=n.mobileLink,d=n.mobileAppLink,v=n.wxMiniprogramOriginalId,f=n.wxMiniprogramLink;switch(l){case LinkType.Normal:p=k;break;case LinkType.MultiPlatform:p=d||c}var m=null;return l!==LinkType.Normal&&(m={mobileLink:formatLink(c),wxMiniprogramOriginalId:v,wxMiniprogramLink:formatLink(f),mobileAppLink:formatLink(d)}),void toPlvWebviewBridge({link:formatLink(p),data:m,getPlvWebviewSmallWindowSize:o,getPlvWebviewBridge:r})}if(l!==LinkType.Normal)l===LinkType.MultiPlatform&&toMultiPlatformLink({linkData:n,isWxMiniProgramEnv:a,toWxMiniProgram:s,openLink:e});else{k=n.link;var L=n.jumpWay;e(formatLink(k),L)}}else toNativeLink({androidLink:formatLink(n.androidLink),iosLink:formatLink(n.iosLink),otherLink:formatLink(n.otherLink)})}exports.isAndroid=uaInfo.os.isAndroid,exports.isIOS=uaInfo.os.isIOS,exports.isWeixin=uaInfo.client.isWx,exports.isWorkWeixin=uaInfo.client.isWxWork,exports.isPcMiniProgram=(exports.isWeixin||exports.isWorkWeixin)&&/miniprogramenv/.test(ua),exports.isMobile=__isMobile()||exports.isPcMiniProgram,function(i){i[i.Normal=10]="Normal",i[i.MultiPlatform=11]="MultiPlatform",i[i.Native=12]="Native"}(LinkType||(exports.LinkType=LinkType={})),function(i){i.PopUp="POP_UP",i.NewWindow="NEW_WINDOW",i.CurrentWindow="CURRENT_WINDOW"}(LinkJumpWay||(exports.LinkJumpWay=LinkJumpWay={}));