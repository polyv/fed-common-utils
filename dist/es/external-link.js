var __awaiter=this&&this.__awaiter||function(i,n,o,t){return new(o||(o=Promise))((function(e,a){function r(i){try{d(t.next(i))}catch(i){a(i)}}function l(i){try{d(t.throw(i))}catch(i){a(i)}}function d(i){var n;i.done?e(i.value):(n=i.value,n instanceof o?n:new o((function(i){i(n)}))).then(r,l)}d((t=t.apply(i,n||[])).next())}))};import{getCurrentUAInfo}from"@just4/ua-info";import{concat}from"@just4/querystring";const uaInfo=getCurrentUAInfo();export const isAndroid=uaInfo.os.isAndroid;export const isIOS=uaInfo.os.isIOS;export var LinkType;!function(i){i[i.Normal=10]="Normal",i[i.MultiPlatform=11]="MultiPlatform",i[i.Native=12]="Native"}(LinkType||(LinkType={}));export var LinkJumpWay;function invokeNativePointMall(i){var n,o,t,e,a,r;isAndroid?null===(o=null===(n=window.AndroidNative)||void 0===n?void 0:n.toPointMall)||void 0===o||o.call(n,i):isIOS&&(null===(r=null===(a=null===(e=null===(t=window.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===e?void 0:e.gotoPointsMall)||void 0===a?void 0:a.postMessage)||void 0===r||r.call(a,i))}function toNativeLink(i){var n,o,t,e;const{androidLink:a,iosLink:r,otherLink:l}=i;if(!(null===(n=window.AndroidNative)||void 0===n?void 0:n.toPointMall)&&!(null===(e=null===(t=null===(o=window.webkit)||void 0===o?void 0:o.messageHandlers)||void 0===t?void 0:t.gotoPointsMall)||void 0===e?void 0:e.postMessage))return void window.open(l,"_blank","noopener=yes");let d=isAndroid?a:r;const k=encodeURIComponent(location.href);d=concat(d,{plt_back_uri:k});invokeNativePointMall(JSON.stringify({url:d}))}function toPlvWebviewBridge(i){return __awaiter(this,void 0,void 0,(function*(){const{getPlvWebviewSmallWindowSize:n,getPlvWebviewBridge:o}=i,t=(null==n?void 0:n())||{width:90,height:160},e=yield null==o?void 0:o();e&&e.sendData("clickProduct",{width:t.width,height:t.height,newPage:!0,link:i.link,data:i.data})}))}function toMultiPlatformLink(i){return __awaiter(this,void 0,void 0,(function*(){const{linkData:n,isWxMiniProgramEnv:o,toWxMiniProgram:t,openLink:e,getLinkParams:a,isMobile:r}=i,{wxMiniprogramLink:l,mobileLink:d,pcLink:k}=n,v=(null==r?void 0:r())||!1;let s=!1;try{s=(yield null==o?void 0:o())||!1}catch(i){s=!1}s&&l&&t?t(formatLink(l,a)):v&&d?e(formatLink(d,a),LinkJumpWay.NewWindow):!v&&k&&e(formatLink(k,a),LinkJumpWay.NewWindow)}))}!function(i){i.PopUp="POP_UP",i.NewWindow="NEW_WINDOW",i.CurrentWindow="CURRENT_WINDOW"}(LinkJumpWay||(LinkJumpWay={}));export function formatLink(i,n){let o={};if(n){const t=n(i);o=Object.assign({},o,t)}return concat(i,o)}export function navigateToLink(i){const{linkData:n,openLink:o,isPlvWebview:t,getPlvWebviewSmallWindowSize:e,getPlvWebviewBridge:a,isWxMiniProgramEnv:r,toWxMiniProgram:l,getLinkParams:d,isMobile:k}=i,{linkType:v}=n,s=(null==t?void 0:t())||!1;if(v!==LinkType.Native){if(s){let i="";const{link:o,mobileLink:t,mobileAppLink:r,wxMiniprogramOriginalId:l,wxMiniprogramLink:k}=n;switch(v){case LinkType.Normal:i=o;break;case LinkType.MultiPlatform:i=r||t}let s=null;return v!==LinkType.Normal&&(s={mobileLink:formatLink(t,d),wxMiniprogramOriginalId:l,wxMiniprogramLink:formatLink(k,d),mobileAppLink:formatLink(r,d)}),void toPlvWebviewBridge({link:formatLink(i,d),data:s,getPlvWebviewSmallWindowSize:e,getPlvWebviewBridge:a})}if(v!==LinkType.Normal)v===LinkType.MultiPlatform&&toMultiPlatformLink({linkData:n,getLinkParams:d,isWxMiniProgramEnv:r,toWxMiniProgram:l,openLink:o,isMobile:k});else{const{link:i,jumpWay:t}=n;o(formatLink(i,d),t)}}else toNativeLink({androidLink:formatLink(n.androidLink,d),iosLink:formatLink(n.iosLink,d),otherLink:formatLink(n.otherLink,d)})}