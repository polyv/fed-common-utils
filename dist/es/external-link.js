var __awaiter=this&&this.__awaiter||function(i,n,o,t){return new(o||(o=Promise))((function(e,a){function r(i){try{k(t.next(i))}catch(i){a(i)}}function l(i){try{k(t.throw(i))}catch(i){a(i)}}function k(i){var n;i.done?e(i.value):(n=i.value,n instanceof o?n:new o((function(i){i(n)}))).then(r,l)}k((t=t.apply(i,n||[])).next())}))};import{getCurrentUAInfo}from"@just4/ua-info";import{concat}from"@just4/querystring";const uaInfo=getCurrentUAInfo();export const isAndroid=uaInfo.os.isAndroid;export const isIOS=uaInfo.os.isIOS;export var LinkType;!function(i){i[i.Normal=10]="Normal",i[i.MultiPlatform=11]="MultiPlatform",i[i.Native=12]="Native"}(LinkType||(LinkType={}));export var LinkJumpWay;function getNativeToPointMallFn(){var i,n,o,t;return isAndroid?null===(i=window.AndroidNative)||void 0===i?void 0:i.toPointMall:isIOS?null===(t=null===(o=null===(n=window.webkit)||void 0===n?void 0:n.messageHandlers)||void 0===o?void 0:o.gotoPointsMall)||void 0===t?void 0:t.postMessage:void 0}function toNativeLink(i){const{androidLink:n,iosLink:o,otherLink:t}=i,e=getNativeToPointMallFn();if(e){let i=isAndroid?n:o;const t=encodeURIComponent(location.href);i=concat(i,{plt_back_uri:t});e(JSON.stringify({url:i}))}else window.open(t,"_blank","noopener=yes")}function toPlvWebviewBridge(i){return __awaiter(this,void 0,void 0,(function*(){const{getPlvWebviewSmallWindowSize:n,getPlvWebviewBridge:o}=i,t=(null==n?void 0:n())||{width:90,height:160},e=yield null==o?void 0:o();e&&e.sendData("clickProduct",{width:t.width,height:t.height,newPage:!0,link:i.link,data:i.data})}))}function toMultiPlatformLink(i){return __awaiter(this,void 0,void 0,(function*(){const{linkData:n,isWxMiniProgramEnv:o,toWxMiniProgram:t,openLink:e,getLinkParams:a,isMobile:r}=i,{wxMiniprogramLink:l,mobileLink:k,pcLink:d}=n,s=(null==r?void 0:r())||!1;let u=!1;try{u=(yield null==o?void 0:o())||!1}catch(i){u=!1}u&&l&&t?t(formatLink(l,a)):s&&k?e(formatLink(k,a),LinkJumpWay.NewWindow):!s&&d&&e(formatLink(d,a),LinkJumpWay.NewWindow)}))}!function(i){i.PopUp="POP_UP",i.NewWindow="NEW_WINDOW",i.CurrentWindow="CURRENT_WINDOW"}(LinkJumpWay||(LinkJumpWay={}));export function formatLink(i,n){let o={};if(n){const t=n(i);o=Object.assign({},o,t)}return concat(i,o)}export function navigateToLink(i){const{linkData:n,openLink:o,isPlvWebview:t,getPlvWebviewSmallWindowSize:e,getPlvWebviewBridge:a,isWxMiniProgramEnv:r,toWxMiniProgram:l,getLinkParams:k,isMobile:d}=i,{linkType:s}=n,u=(null==t?void 0:t())||!1;if(s!==LinkType.Native){if(u){let i="";const{link:o,mobileLink:t,mobileAppLink:r,wxMiniprogramOriginalId:l,wxMiniprogramLink:d}=n;switch(s){case LinkType.Normal:i=o;break;case LinkType.MultiPlatform:i=r||t}let u=null;return s!==LinkType.Normal&&(u={mobileLink:formatLink(t,k),wxMiniprogramOriginalId:l,wxMiniprogramLink:formatLink(d,k),mobileAppLink:formatLink(r,k)}),void toPlvWebviewBridge({link:formatLink(i,k),data:u,getPlvWebviewSmallWindowSize:e,getPlvWebviewBridge:a})}if(s!==LinkType.Normal)s===LinkType.MultiPlatform&&toMultiPlatformLink({linkData:n,getLinkParams:k,isWxMiniProgramEnv:r,toWxMiniProgram:l,openLink:o,isMobile:d});else{const{link:i,jumpWay:t}=n;o(formatLink(i,k),t)}}else toNativeLink({androidLink:formatLink(n.androidLink,k),iosLink:formatLink(n.iosLink,k),otherLink:formatLink(n.otherLink,k)})}