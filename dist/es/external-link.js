var __awaiter=this&&this.__awaiter||function(i,n,o,t){return new(o||(o=Promise))((function(e,r){function a(i){try{s(t.next(i))}catch(i){r(i)}}function l(i){try{s(t.throw(i))}catch(i){r(i)}}function s(i){var n;i.done?e(i.value):(n=i.value,n instanceof o?n:new o((function(i){i(n)}))).then(a,l)}s((t=t.apply(i,n||[])).next())}))};import{getCurrentUAInfo}from"@just4/ua-info";import{concat}from"@just4/querystring";const ua=navigator.userAgent.toLowerCase(),uaInfo=getCurrentUAInfo();export const isAndroid=uaInfo.os.isAndroid;export const isIOS=uaInfo.os.isIOS;export const isWeixin=uaInfo.client.isWx;export const isWorkWeixin=uaInfo.client.isWxWork;export const isPcMiniProgram=(isWeixin||isWorkWeixin)&&/miniprogramenv/.test(ua);export const isMobile=uaInfo.isPortable||isPcMiniProgram;export var LinkType;!function(i){i[i.Normal=10]="Normal",i[i.MultiPlatform=11]="MultiPlatform",i[i.Native=12]="Native"}(LinkType||(LinkType={}));export var LinkJumpWay;function getNativeToPointMallFn(){var i,n,o,t;return isAndroid?null===(i=window.AndroidNative)||void 0===i?void 0:i.toPointMall:isIOS?null===(t=null===(o=null===(n=window.webkit)||void 0===n?void 0:n.messageHandlers)||void 0===o?void 0:o.gotoPointsMall)||void 0===t?void 0:t.postMessage:void 0}function toNativeLink(i){const{androidLink:n,iosLink:o,otherLink:t}=i,e=getNativeToPointMallFn();if(e){let i=isAndroid?n:o;const t=encodeURIComponent(location.href);i=concat(i,{plt_back_uri:t});e(JSON.stringify({url:i}))}else window.open(t,"_blank","noopener=yes")}function toPlvWebviewBridge(i){return __awaiter(this,void 0,void 0,(function*(){const{getPlvWebviewSmallWindowSize:n,getPlvWebviewBridge:o}=i,t=(null==n?void 0:n())||{width:90,height:160},e=yield null==o?void 0:o();e&&e.sendData("clickProduct",{width:t.width,height:t.height,newPage:!0,link:i.link,data:i.data})}))}function toMultiPlatformLink(i){return __awaiter(this,void 0,void 0,(function*(){const{linkData:n,isWxMiniProgramEnv:o,toWxMiniProgram:t,openLink:e,getLinkParams:r}=i,{wxMiniprogramLink:a,mobileLink:l,pcLink:s}=n;let k=!1;try{k=(yield null==o?void 0:o())||!1}catch(i){k=!1}k&&a&&t?t(formatLink(a,r)):isMobile?e(formatLink(l,r),LinkJumpWay.NewWindow):isMobile||e(formatLink(s,r),LinkJumpWay.NewWindow)}))}!function(i){i.PopUp="POP_UP",i.NewWindow="NEW_WINDOW",i.CurrentWindow="CURRENT_WINDOW"}(LinkJumpWay||(LinkJumpWay={}));export function formatLink(i,n){let o={};if(n){const t=n(i);o=Object.assign({},o,t)}return concat(i,o)}export function navigateToLink(i){const{linkData:n,openLink:o,isPlvWebview:t,getPlvWebviewSmallWindowSize:e,getPlvWebviewBridge:r,isWxMiniProgramEnv:a,toWxMiniProgram:l,getLinkParams:s}=i,{linkType:k}=n,d=(null==t?void 0:t())||!1;if(k!==LinkType.Native){if(d){let i="";const{link:o,mobileLink:t,mobileAppLink:a,wxMiniprogramOriginalId:l,wxMiniprogramLink:d}=n;switch(k){case LinkType.Normal:i=o;break;case LinkType.MultiPlatform:i=a||t}let u=null;return k!==LinkType.Normal&&(u={mobileLink:formatLink(t,s),wxMiniprogramOriginalId:l,wxMiniprogramLink:formatLink(d,s),mobileAppLink:formatLink(a,s)}),void toPlvWebviewBridge({link:formatLink(i,s),data:u,getPlvWebviewSmallWindowSize:e,getPlvWebviewBridge:r})}if(k!==LinkType.Normal)k===LinkType.MultiPlatform&&toMultiPlatformLink({linkData:n,getLinkParams:s,isWxMiniProgramEnv:a,toWxMiniProgram:l,openLink:o});else{const{link:i,jumpWay:t}=n;o(formatLink(i,s),t)}}else toNativeLink({androidLink:formatLink(n.androidLink,s),iosLink:formatLink(n.iosLink,s),otherLink:formatLink(n.otherLink,s)})}