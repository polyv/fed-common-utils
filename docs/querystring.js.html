<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: querystring.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: querystring.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * 本模块提供 URL 查询字符串的操作方法。
 * @module querystring
 */

import { hasOwnProp } from './lang';

/**
 * 把查询字符串反序列化为键值对集合。
 * @author luoliquan
 * @param {string} str 查询字符串。
 * @return {Object} 键值对集合。
 * @example
 * parse('a=1&amp;%E9%94%AE=%E5%80%BC'); // { a: 1, '键': '值' }
 * parse('a=1&amp;a=2&amp;b=3'); // { a: [1, 2], b: 3 }
 */
export function parse(str) {
  if (typeof str !== 'string') {
    throw new Error('The str argument must be a string type');
  }

  const result = {};

  str.split('&amp;').forEach(function(pair) {
    if (!pair) { return; }
    pair = pair.split('=');
    const key = decodeURIComponent(pair[0]);
    const value = decodeURIComponent(pair[1] || '');

    if (hasOwnProp(result, key)) {
      // 出现重复 key 值时解析为数组
      if (!Array.isArray(result[key])) {
        result[key] = [result[key]];
      }
      result[key].push(value);
    } else {
      result[key] = value;
    }
  });

  return result;
}

/**
 * 把键值对集合序列化为查询字符串。
 * @author luoliquan
 * @param {Object} data 键值对集合。
 * @param {Object} [options] 参数。
 *   @param {Boolean} [options.ignoreEmpty=false] 是否忽略空值（包括null、undefined、空字符串）。
 * @return {string} 序列化结果。
 * @example
 * stringify({ a: 1, '键': '值' }); // 'a=1&amp;%E9%94%AE=%E5%80%BC'
 * stringify({ a: [1, 2], b: 3 }); // 'a=1&amp;a=2&amp;b=3'
 */
export function stringify(data, options) {
  options = options || {};

  const result = [];
  function addToResult(key, value) {
    if (value == null) { value = ''; }
    // 忽略空值的情况
    if (value === '' &amp;&amp; options.ignoreEmpty) { return; }

    result.push(encodeURIComponent(key) + '=' + encodeURIComponent(value));
  }

  let key, value;

  // 避免在循环中生成匿名函数，提到循环外
  function loopItem(item) { addToResult(key, item); }

  for (key in data) {
    if (hasOwnProp(data, key)) {
      value = data[key];
      if (Array.isArray(value)) {
        value.forEach(loopItem);
      } else {
        addToResult(key, value);
      }
    }
  }

  return result.join('&amp;');
}

/**
 * 把键值对集合序列化为查询字符串后拼接到指定URL。
 * @author luoliquan
 * @param {string} url 指定URL。
 * @param {Object|string} data 键值对集合。
 * @param {Object} [options] 参数。
 *   @param {Boolean} [options.ignoreEmpty] 序列化时是否忽略空值（包括null、undefined、空字符串）。
 * @return {String} 处理后的URL。
 * @example
 * append('http://abc.com?a=1', { b: 2, c: 3 }); // 'http://abc.com?a=1&amp;b=2&amp;c=3'
 * append('http://abc.com', { a: 1, b: 2 }); // 'http://abc.com?a=1&amp;b=2'
 */
export function append(url, data, options) {
  if (url == null) { return url; }
  url = String(url);

  // 如果url中包含hash，要先剪出来
  const temp = url.indexOf('#');
  let hash = '';
  if (temp !== -1) {
    hash = url.substring(temp, url.length);
    url = url.substring(0, temp);
  }

  // 移除位于末尾的?和&amp;，方便拼接
  url = url.replace(/[?&amp;]$/, '');

  if (typeof data !== 'string') {
    data = stringify(data, options);
  } else {
    // 移除位于开头的?和&amp;，方便拼接
    data = data.replace(/^[?&amp;]/, '');
  }

  return url + (
    data ? ((url.indexOf('?') !== -1 ? '&amp;' : '?') + data) : ''
  ) + hash;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-boolean.html">boolean</a></li><li><a href="module-browser.html">browser</a></li><li><a href="module-cookie.html">cookie</a></li><li><a href="module-countdown.html">countdown</a></li><li><a href="module-date.html">date</a></li><li><a href="module-lang.html">lang</a></li><li><a href="module-net.html">net</a></li><li><a href="module-polling.html">polling</a></li><li><a href="module-querystring.html">querystring</a></li><li><a href="module-storage.html">storage</a></li><li><a href="module-string.html">string</a></li><li><a href="module-validate.html">validate</a></li></ul><h3>Classes</h3><ul><li><a href="module-countdown.Countdown.html">Countdown</a></li><li><a href="module-polling.Polling.html">Polling</a></li><li><a href="module-storage.StorageWrap.html">StorageWrap</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Wed Apr 27 2022 10:51:30 GMT+0800 (中国标准时间)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
