<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: cookie.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: cookie.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * 本模块提供 cookie 读写方法。
 * @module cookie
 */

import { isDate } from './internal/core';
import { addToDate } from './internal/timeunit';

/**
 * 写入 cookie。
 * @author luoliquan
 * @param {string} key cookie 键。
 * @param {string} value cookie 值。
 * @param {Object} [options] 参数。
 *   @param {string} [options.domain] 所在域。
 *   @param {string} [options.path] 所在路径。
 *   @param {(Date|number|string)} [options.expires] 过期时间。
 *     为日期类型时表示绝对时间；
 *     为数字（单位毫秒）时表示相对时间（当前时间+相对值）；
 *     为字符串时表示相对时间（当前时间+相对值），支持格式包括（%表示数字）：
 *       %secs，
 *       %mins，
 *       %hours，
 *       %days，
 *       %months，
 *       %years。
 *   @param {boolean} [options.secure] 是否只在 https 连接中有效。
 *   @param {string} [options.sameSite] 访问限制：Lax、Strict 或 None。
 * @example
 * cookie.set('a', '1')
 * cookie.set('b', '2', {
 *   expires: '6months', // 180 天
 *   domain: '.polyv.net',
 *   path: '/'
 * });
 */
export function set(key, value, options) {
  options = options || {};

  let content = encodeURIComponent(key) + '=' + encodeURIComponent(value);
  if (options.expires != null) {
    content += '; expires=' + (
      isDate(options.expires) ?
        options.expires :
        addToDate(new Date(), options.expires)
    ).toUTCString();
  }
  if (options.path) { content += '; path=' + options.path; }
  if (options.domain) { content += '; domain=' + options.domain; }
  if (options.secure === true) { content += '; secure'; }
  if (options.sameSite) {
    const sameSite = String(options.sameSite).toLowerCase();
    if (['lax', 'strict', 'none'].indexOf(sameSite) !== -1) {
      content += '; samesite=' + sameSite;
    }
  }

  document.cookie = content;
}

/**
 * 读取 cookie。
 * @author luoliquan
 * @param {string} name cookie 名。
 * @return {string} cookie 值。
 * @example
 * cookie.get('a');
 */
export function get(key) {
  key = '; ' + encodeURIComponent(key) + '=';
  const cookie = '; ' + document.cookie;

  let beginPos = cookie.indexOf(key);
  if (beginPos === -1) { return null; }
  beginPos += key.length;

  let endPos = cookie.indexOf(';', beginPos);
  if (endPos === -1) { endPos = cookie.length; }

  return decodeURIComponent(cookie.substring(beginPos, endPos));
}

// iOS 9 下设置过期不会马上生效，先设为空
const shouldSetEmptyBeforeRemove = (function() {
  // 兼容 Node 端（主要针对同构应用）引入
  if (typeof document === 'undefined') { return false; }

  const TEST_KEY = '__jraiser__test__cookie__';
  document.cookie = TEST_KEY + '=1';
  document.cookie = TEST_KEY + '=;expires=Thu, 01 Jan 1970 00:00:00 GMT';
  return !!get(TEST_KEY);
})();

/**
 * 移除 cookie。
 * @author luoliquan
 * @param {string} name cookie 名。
 * @param {Object} [options] 参数。
 *   @param {string} [options.domain] 所在域。
 *   @param {string} [options.path] 所在路径。
 * @example
 * remove('a');
 * remove('b' {
 *   domain: '.polyv.net',
 *   path: '/abc'
 * })
 */
export function remove(name, options) {
  if (shouldSetEmptyBeforeRemove) { set(name, '', options); }

  options = options || {};
  // 让其过期即为删除
  options.expires = new Date(0);
  set(name, '', options);
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-boolean.html">boolean</a></li><li><a href="module-browser.html">browser</a></li><li><a href="module-cookie.html">cookie</a></li><li><a href="module-countdown.html">countdown</a></li><li><a href="module-date.html">date</a></li><li><a href="module-lang.html">lang</a></li><li><a href="module-net.html">net</a></li><li><a href="module-polling.html">polling</a></li><li><a href="module-querystring.html">querystring</a></li><li><a href="module-storage.html">storage</a></li><li><a href="module-string.html">string</a></li><li><a href="module-validate.html">validate</a></li></ul><h3>Classes</h3><ul><li><a href="module-countdown.Countdown.html">Countdown</a></li><li><a href="module-polling.Polling.html">Polling</a></li><li><a href="module-storage.StorageWrap.html">StorageWrap</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Wed Jun 16 2021 15:30:19 GMT+0800 (GMT+08:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
